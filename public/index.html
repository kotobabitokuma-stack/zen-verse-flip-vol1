<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <script>
        // 2. 読み込み後、即座に初期化を実行
        function init() {
            try {
                // あえてバージョンを数値の 1 だけにする
                window.Pi.init({ version: "1" });
                window.Pi.authenticate(['username', 'payments'], function(p){})
                .then(function(auth) {
                    document.getElementById('status').innerText = "接続成功: " + auth.user.username;
                    document.getElementById('pay-btn').style.display = "block";
                })
                .catch(function(e) {
                    document.getElementById('status').innerText = "認証エラー: " + e.message;
                });
            } catch (e) {
                // 失敗したらすぐに再試行
                setTimeout(init, 1000);
            }
        }
        window.onload = init;
    </script>
</head>
<body>
    <h1 id="status">Pi 接続待機中...</h1>
    <button id="pay-btn" onclick="/* 決済処理 */" style="display:none; padding:20px; background:gold;">Support (3 Pi)</button>
</body>
</html>
